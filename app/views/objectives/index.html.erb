<p id="notice"><%= notice %></p>

<h1>
  Quarterly objectives
  <small class="text-muted"><%= @current_quarter.date_range_formatted %></small>
</h1>

<div class="card shadow mt-5 mb-5 bg-light rounded">
  <div class="card-header">
    Create new objective
  </div>
  <div class="card-body">
    <%= form_with(url: objectives_path) do |f| %>
      <%= f.hidden_field :objective_id, value: @objective_id %>
      <%= f.hidden_field :quarter_start_date, value: @current_quarter.start_date %>
      <div class="form-group row">
        <div class="col-sm-10">
          <%= f.text_field :title, class: 'form-control', placeholder: 'Something ambitious, like "Improve the quality of my blog writing by the end of the year"' %>
        </div>
        <div class="col-sm-2">
          <%= f.submit 'Create objective', {class: 'btn btn-primary'} %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% @objectives.each do |objective| %>
  <div class="card shadow mb-5 rounded">
    <div class="card-body">
      <h5 class="card-title">
        <small class="text-muted">Objective:</small>
        <%= objective.title %>
      </h5>

      <% if objective.key_results.any? %>
        <p class="text-muted">Key results:</small>
        <div class="ml-2">
          <ul>
            <% objective.key_results.each do |key_result| %>
              <li><%= key_result.title %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= form_with(url: objective_key_results_path(objective_id: objective.uid)) do |f| %>
          <div class="form-group row">
            <div class="col-sm-10">
              <%= f.text_field :title, class: 'form-control', placeholder: 'Something measurable, like "My blog was shared 5 times"' %>
            </div>
            <div class="col-sm-2">
              <%= f.submit 'Create key result', {class: 'btn btn-secondary'} %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
